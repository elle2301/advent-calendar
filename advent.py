import streamlit as stimport requestsimport jsonimport datetime# ================== JSONBIN CONFIG ==================API_KEY = st.secrets["jsonbin"]["api_key"]BIN_ID   = st.secrets["jsonbin"]["bin_id"]# HEADERS M√úSSEN OBEN STEHEN ‚Äì VOR DEN FUNKTIONENheaders = {    "X-Master-Key": API_KEY,    "Content-Type": "application/json"}# URLs f√ºr JSONBinBASE_URL_GET = f"https://api.jsonbin.io/v3/b/{BIN_ID}/latest"BASE_URL_PUT = f"https://api.jsonbin.io/v3/b/{BIN_ID}"def load_open_doors():    try:        res = requests.get(BASE_URL_GET, headers=headers)        data = res.json()        return set(data["record"].get("open_doors", []))    except Exception as e:        st.error(f"Error loading doors: {e}")        return set()def save_open_doors(doors):    try:        payload = {"open_doors": list(doors)}        requests.put(BASE_URL_PUT, headers=headers, json=payload)    except Exception as e:        st.error(f"Error saving doors: {e}")# ================== STREAMLIT PAGE CONFIG ==================st.set_page_config(page_title="Advent Calendar", layout="wide")# ================== LOAD GLOBAL STATE ==================global_open_doors = load_open_doors()if "open_doors" not in st.session_state:    st.session_state.open_doors = set(global_open_doors)# ================== DATE LOGIC ==================today = datetime.date.today()current_day = today.day if today.month == 12 else 0# zum Testen:# current_day = 24# ================== STYLES (inkl. Schnee) ==================st.markdown("""<style>body {    background: #0d0f15;    overflow-x: hidden;}/* Schneeflocken */@keyframes snow {    0% { transform: translateY(-10px); opacity: 1; }    100% { transform: translateY(100vh); opacity: 0; }}.snowflake {    position: fixed;    top: -10px;    color: white;    font-size: 24px;    opacity: 0.9;    pointer-events: none;    z-index: 99999;    animation: snow linear infinite;}.snowflake:nth-child(1) { left: 10%; animation-duration: 9s; }.snowflake:nth-child(2) { left: 30%; animation-duration: 12s; }.snowflake:nth-child(3) { left: 50%; animation-duration: 8s; }.snowflake:nth-child(4) { left: 70%; animation-duration: 11s; }.snowflake:nth-child(5) { left: 90%; animation-duration: 10s; }/* Header */.header-title {    text-align: center;    font-size: 60px;    font-weight: 800;    color: #5ee6ff;    padding-top: 10px;}.date-text {    text-align: center;    font-size: 22px;    color: #ddd;    margin-bottom: 30px;}/* T√ºr-Buttons (alle Streamlit-Buttons) */div.stButton > button {    background-color: #d62828 !important;    color: white !important;    font-size: 24px !important;    font-weight: bold !important;    border-radius: 18px !important;    padding: 22px !important;    width: 100% !important;    height: 120px !important;    transition: 0.2s ease-in-out;}div.stButton > button:hover {    background-color: #f77f00 !important;    transform: scale(1.05);    box-shadow: 0 0 20px #fcd46a;}/* Ge√∂ffnete T√ºr-Textbox (in der Spalte, aber sch√∂n breit) */.open-box {    background: rgba(255, 245, 200, 0.97);    border: 3px solid gold;    border-radius: 20px;    padding: 24px;    margin-top: 14px;    width: 100%;    color: #222;    box-shadow: 0 0 20px gold;    font-size: 17px;    line-height: 1.55;}</style><div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÑ</div><div class="snowflake">‚ùÑ</div>""", unsafe_allow_html=True)# ================== HEADER ==================st.markdown("<h1 class='header-title'>üéÑ Advent Calendar 2025 üéÑ</h1>", unsafe_allow_html=True)st.markdown(    f"<p class='date-text'>Today is <b>{today.strftime('%B %d, %Y')}</b></p>",    unsafe_allow_html=True)# ================== EMOJIS ==================emojis = [    "üéÅ","üç™","‚òÉÔ∏è","üéÑ","üïØÔ∏è","üç´",    "‚ùÑÔ∏è","üß¶","üé∂","ü¶å","üåü","üõ∑",    "üç≠","ü•õ","üõçÔ∏è","üéâ","üß∏","üçé",    "ü•®","üïäÔ∏è","üéÖ","üßë‚ÄçüéÑ","üîî","‚ú®"]# ========== DOOR TEXT (EXACTLY AS YOU PROVIDED) ==========door_text = {1: """Rudolph is missing!On December 1st, Michael Rabes appears panicked in the Fixed Network Performance Team‚Äôs video conference. ‚ÄúRudolph is gone!‚Äù he calls out. ‚ÄúHis GPS horn isn‚Äôt sending any signal!‚Äù We need a search team immediately.Davide immediately contacts his former colleagues from Mobile Benchmarking and asks for an initial IP-trace analysis ‚Äì unsuccessfully. The team decides to start the search simultaneously in all countries.‚ùì Puzzle 1What kind of animal is Rudolph? Write down the first letter of that animal.""",2: """A first clue from SpainSusana and Marta first scan the GCP for traces to find the last signal from the Rudolph tracker. According to the IP, the signal ends in northeastern Spain.‚ÄúMaybe he's at the Cabalgata preparations,‚Äù Marta suspects.‚ùì Puzzle 2In which region of Spain did the signal end? The first letter of the region is required.""",3: """Barcelona at NightIn nighttime Barcelona, Carlos sets up a Teams conference and reports to Madrid that a red light was seen above the Sagrada Fam√≠lia. But suddenly Manuel dials into the call and points out that‚Ä¶‚ùì Puzzle 3What color is Rudolph‚Äôs nose? We are looking for the first letter.""",4: """Off to Italy‚Ä¶ the signal suddenly jumped to Italy. They immediately call Sonia and Silvia. They search for unusual activity and find an oddity! With a deviation of 3.9m vertically, they stumble upon‚Ä¶‚ùì Puzzle 4‚Ä¶a landmark in Italy with a vertical deviation of 3.9m?The first letter of the city where it is located is required.""",5: """The Witch BefanaMeanwhile, Massimo pursues an entirely different idea and reminds the team of the Italian tradition of the ‚ÄúBefana,‚Äù who brings gifts on January 6th.But surely a witch didn‚Äôt kidnap Rudolph‚Ä¶ or did she? Just to be safe, he creates a year-over-year comparison analysis.‚ùì Puzzle 5What is the third letter of the abbreviation for a year-over-year comparison?""",6: """Romanian TraceAn LTE cell handover suddenly leads to Romania. Carmen and Lucian discover a hoofprint in snowy Cluj.‚ùì Puzzle 6What is a typical festive cake served at Easter and Christmas in Romania? Write down the fourth letter.""",7: """Traditions in TransylvaniaWhile Jana investigates local customs with the team, they hear of a ‚Äúred star in the sky.‚Äù Was it Rudolph?‚ùì Puzzle 7Which letter corresponds to the 8th letter of the alphabet?""",8: """The Code in the SnowManuel discovers a pattern in the snow ‚Äì like a binary code.‚ÄúMaybe Rudolph tried to communicate!‚Äù‚ùì Puzzle 8Which letter corresponds to ASCII code 69?""",9: """Shift to GermanyAn FWA sensor in the Black Forest detects a strong heat source ‚Äì could be Rudolph‚Äôs nose, Michael thinks.‚ùì Puzzle 9A typical hot German drink served at Christmas markets that can cause a red nose? Write down the second letter of the second word.""",10: """Technical BreakthroughPaco and Jose Luis reconstruct a voice packet from Rudolph‚Äôs tracker. It contains only one word: ‚ÄúNordpol‚Äù (North Pole).‚ùì Puzzle 10What is the name of a special type of table in Excel? Take the first letter.""",11: """Czech Republic CallingA mobile operator reports a strange red light reflection near Brno.Miroslav heads off immediately.‚ùì Puzzle 11The first letter of a Czech Christmas tradition is needed.""",12: """The Golem of PragueHis path leads into an old town said to be protected by a Golem. Has he perhaps tracked Rudolph?‚ùì Puzzle 12Where did Miroslav go? Write down the first letter of the city.""",13: """The whole team now meets online. Miguel analyzes all signals and movement patterns:‚ÄúRudolph moves cyclically ‚Äì as if someone is letting him fly!‚Äù‚ùì Puzzle 13How do you write ‚ÄúSchlitten‚Äù in English? Remember the first letter.""",14: """Christmas Magic in MadridWhile Javier continues interpreting the data, new traces appear in Madrid ‚Äì at a light show with 3D projections.‚ùì Puzzle 14Which cavity is traditionally filled with gifts and sweets until December 24/25 in Aragon? Write down the first letter of the second word.""",15: """Hologram or Reality?Michelle realizes that some sightings were only projections ‚Äì but one signal is real.‚ùì Puzzle 15When spotting which ‚Äústar‚Äù may people in many countries make a wish?Write down the tenth letter of the German word.""",16: """The IP AddressA ping returns a strange result: 24.12.25.12 ‚Äì Santa?‚ùì Puzzle 16What does the abbreviation ‚ÄúIP‚Äù stand for? The fifth letter is required.""",17: """The Northern RouteA final peak in Netperform shows strange latencies heading north ‚Äì but not to the North Pole, rather directly to a star belonging to the constellation of the Little Bear.‚ùì Puzzle 17Which star is meant? Write down the first letter.""",18: """In the Land of ReindeerThe team arrives in Levi, Finland.Reindeer tracks everywhere ‚Äì but no sign of Rudolph.‚ùì Puzzle 18A Finnish sauna has a temperature of 120¬∞ and a ‚Ä¶of 10%?Write down the second-to-last letter.""",19: """The Secret CabinMelanie points to an odd weak curve. A faint Bluetooth signal, as Michael explains.‚ÄúThat‚Äôs Rudolph‚Äôs emergency transmitter!‚Äù Susana shouts excitedly.‚ùì Puzzle 19Which letter is the abbreviation for ‚ÄúSignal to Noise Ratio‚Äù?From the third word, take the fourth letter.""",20: """Rudolph Found!They find Rudolph ‚Äì playful but unharmed.He had been frolicking through the snow with local reindeer.‚ùì Puzzle 20What‚Äôs a common New Year‚Äôs greeting?Take the first letter of the third word.""",21: """But One Problem‚Ä¶Rudolph‚Äôs horn transmitter is broken.The team repairs it with an improvised FWA antenna and secures a fixed IP so he can always be located.‚ùì Puzzle 21What is the first letter of the first name of Jesus' mother?""",22: """Return FlightWith the repaired transmitter, everyone flies back together on the sleigh.The Christmas mission is saved!‚ùì Puzzle 22What is the name of the vertical axis in a chart? Write down the first letter.""",23: """Big Christmas WorkshopBack home, Melanie thanks the team: ‚ÄúYou saved Christmas!‚Äù and ‚Ä¶‚ùì Puzzle 23Which letter corresponds to this UTF-8 code: U+1D39?""",24: """Merry Christmas!‚Äú‚Ä¶ you have shown that together, there is a solution for everything. You are a fantastic team!‚Äù‚ùì What is the final solution phrase?The 24 letters form the solution phrase ‚Äì ignore the letter P."""}# ================== LOAD OPEN DOORS FROM JSONBIN ==================open_doors = load_open_doors()# ================== GRID / LAYOUT ==================cols_per_row = 4  # 4 T√ºren pro Zeile ‚Üí Spalten breiterfor row in range(6):  # 6 Reihen √† 4 T√ºren = 24    cols = st.columns([1.5, 1.5, 1.5, 1.5])    for i, col in enumerate(cols):        door = row * cols_per_row + i + 1        if door > 24:            break        with col:            can_open = (door == current_day)            is_open = door in open_doors            button_label = f"Door {door}"            if not is_open and not can_open:                button_label += " (locked üîí)"            # Open door            if st.button(button_label, key=f"door{door}", disabled=not can_open and not is_open):                open_doors.add(door)                save_open_doors(open_doors)                st.rerun()            # Show the content BELOW the door (always visible once open)            if is_open:                st.markdown(                    f"""                    <div class='open-box' style='margin-top:10px;'>                        {door_text[door]}                    </div>                    """,                    unsafe_allow_html=True                )